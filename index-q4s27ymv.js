var $=`attribute vec4 myPosition;

uniform float xshift;
uniform float yshift;

void main() {
    // Direct position calculation - more efficient than matrix multiplication
    gl_Position = vec4(myPosition.x + xshift, myPosition.y + yshift, 0.0, 1.0);
    gl_PointSize = 1.0;
}`;var Y=`precision mediump float;

uniform vec4 u_color;

void main() {
    gl_FragColor = u_color;
}`;var T="hot"in import.meta?25:500,f="hot"in import.meta?30:60,g="hot"in import.meta?100:1000,H=0.6,C=[1,1,1],k=[0,0,0],m=[{color:[1,0,0.5],speed:1,size:2.5,points:1},{color:[0.6,0.2,0.8],speed:2,size:1.5,points:5},{color:[0,1,1],speed:3,size:1,points:25}];function d(a,c=0.7){return[Math.max(0,a[0]*c),Math.max(0,a[1]*c),Math.max(0,a[2]*c)]}class o{webgl;vertexShader;fragShader;shaderProgram;positionLocation;xshiftLocation;yshiftLocation;colorLocation;programBound=!1;vertexArrayEnabled=!1;constructor(a){this.webgl=a.getContext("webgl"),this.webgl.viewport(0,0,512,512),this.webgl.clearColor(k[0],k[1],k[2],1),this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.vertexShader=this.webgl.createShader(this.webgl.VERTEX_SHADER),this.webgl.shaderSource(this.vertexShader,$),this.webgl.compileShader(this.vertexShader),this.fragShader=this.webgl.createShader(this.webgl.FRAGMENT_SHADER),this.webgl.shaderSource(this.fragShader,Y),this.webgl.compileShader(this.fragShader),this.shaderProgram=this.webgl.createProgram(),this.webgl.attachShader(this.shaderProgram,this.vertexShader),this.webgl.attachShader(this.shaderProgram,this.fragShader),this.webgl.linkProgram(this.shaderProgram),this.webgl.useProgram(this.shaderProgram),this.programBound=!0,this.positionLocation=this.webgl.getAttribLocation(this.shaderProgram,"myPosition"),this.xshiftLocation=this.webgl.getUniformLocation(this.shaderProgram,"xshift"),this.yshiftLocation=this.webgl.getUniformLocation(this.shaderProgram,"yshift"),this.colorLocation=this.webgl.getUniformLocation(this.shaderProgram,"u_color")}createBuffer(a){let c=this.webgl.createBuffer();return this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,c),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,Float32Array.from(a.flat()),this.webgl.STATIC_DRAW),c}clearColorBuffer(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}invalidateProgramState(){this.programBound=!1}draw(a){this.ensureProgramBound(),this.setupVertexAttributes(a.buffer),this.setUniforms(a.uniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length)}drawWithStroke(a){this.ensureProgramBound(),this.setupVertexAttributes(a.buffer),this.setUniforms(a.strokeUniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length),this.setupVertexAttributes(a.mainBuffer),this.setUniforms(a.uniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length)}setupVertexAttributes(a){this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,a),this.ensureVertexArrayEnabled(),this.webgl.vertexAttribPointer(this.positionLocation,2,this.webgl.FLOAT,!1,0,0)}setUniforms(a){this.webgl.uniform1f(this.xshiftLocation,a.xshift),this.webgl.uniform1f(this.yshiftLocation,a.yshift),this.webgl.uniform4f(this.colorLocation,a.color[0],a.color[1],a.color[2],1)}ensureProgramBound(){if(!this.programBound)this.webgl.useProgram(this.shaderProgram),this.programBound=!0}ensureVertexArrayEnabled(){if(!this.vertexArrayEnabled)this.webgl.enableVertexAttribArray(this.positionLocation),this.vertexArrayEnabled=!0}}function q(a,c=0){return a.concat(Array(c).fill(0)).slice(0,c)}function l(...a){return q([...a],2)}class r{points;constructor(a){if(a.length!==4)throw new Error("Wrong number of vertices for a rectangle. Expected 4, but got "+a.length);this.points=a}get topLeft(){return this.points[0]}get topRight(){return this.points[1]}get bottomRight(){return this.points[2]}get bottomLeft(){return this.points[3]}get x(){return this.topLeft[0]}get y(){return this.topLeft[1]}get width(){return this.topRight[0]-this.topLeft[0]}get height(){return this.topLeft[1]-this.bottomLeft[1]}collides(a){let c=this.x<a.x+a.width,i=this.x+this.width>a.x,p=this.y>a.y-a.height,s=this.y-this.height<a.y;return c&&i&&p&&s}}class e extends r{velocity=0;shiftX=0;deltaTrans=0.03;buffer;mainBuffer;constructor(a){super([l(-0.15,-0.925),l(0.15,-0.925),l(0.15,-0.975),l(-0.15,-0.975)]);this.buffer=a.createBuffer(this.points);let c=0.01,i=[l(-0.15+c,-0.925-c),l(0.15-c,-0.925-c),l(0.15-c,-0.975+c),l(-0.15+c,-0.975+c)];this.mainBuffer=a.createBuffer(i)}get uniforms(){return{xshift:this.shiftX,yshift:0,color:C}}get strokeUniforms(){return{xshift:this.shiftX,yshift:0,color:d(C)}}step(a,c){let i=c*this.deltaTrans;if(i*=a/25,this.topLeft[0]+i>=-1.01&&this.bottomRight[0]+i<1.01){this.shiftX+=i;for(let p=0;p<this.points.length;p++)this.points[p][0]=this.points[p][0]+i}}}var n=0.1;class G extends r{blockData;shiftY;deltaTrans;buffer;mainBuffer;active=!1;renderer;constructor(a){super([l(0,0),l(0,0),l(0,0),l(0,0)]);this.renderer=a,this.blockData=m[0],this.shiftY=0,this.deltaTrans=0,this.buffer=a.createBuffer(this.points),this.mainBuffer=a.createBuffer(this.points),this.active=!1,this.reset()}get uniforms(){return{xshift:0,yshift:this.shiftY,color:this.blockData.color}}get strokeUniforms(){return{xshift:0,yshift:this.shiftY,color:d(this.blockData.color,0.6)}}step(a,c=!1){let i=c?this.deltaTrans:-this.deltaTrans;i*=a/25,this.shiftY+=i;for(let p=0;p<this.points.length;p++)this.points[p][1]=this.points[p][1]+i}reset(){let a=Math.floor(Math.random()*m.length);this.blockData=m[a];let c=Math.random()*(1-n*this.blockData.size+1)-1;this.points=[l(c,1.01+n*this.blockData.size),l(c+n*this.blockData.size,1.01+n*this.blockData.size),l(c+n*this.blockData.size,1.01),l(c,1.01)],this.shiftY=0,this.deltaTrans=0.01*this.blockData.speed,this.active=!0,this.renderer.webgl.bindBuffer(this.renderer.webgl.ARRAY_BUFFER,this.buffer),this.renderer.webgl.bufferData(this.renderer.webgl.ARRAY_BUFFER,Float32Array.from(this.points.flat()),this.renderer.webgl.STATIC_DRAW);let i=0.01,p=[l(c+i,1.01+n*this.blockData.size-i),l(c+n*this.blockData.size-i,1.01+n*this.blockData.size-i),l(c+n*this.blockData.size-i,1.01+i),l(c+i,1.01+i)];this.renderer.webgl.bindBuffer(this.renderer.webgl.ARRAY_BUFFER,this.mainBuffer),this.renderer.webgl.bufferData(this.renderer.webgl.ARRAY_BUFFER,Float32Array.from(p.flat()),this.renderer.webgl.STATIC_DRAW)}isActive(){return this.active}prepareForPool(){this.active=!1}}class B{available=[];inUse=new Set;createFn;maxSize;constructor(a,c,i){this.createFn=a,this.maxSize=i??c*2;for(let p=0;p<c;p++){let s=this.createFn();s.reset(),this.available.push(s)}}acquire(){let a;if(this.available.length>0)a=this.available.pop();else if(this.inUse.size<this.maxSize)a=this.createFn();else return null;return this.inUse.add(a),a.reset(),a}release(a){if(this.inUse.has(a))this.inUse.delete(a),a.prepareForPool?.(),this.available.push(a)}releaseInactive(){let a=0;for(let c of this.inUse)if(!c.isActive())this.release(c),a++;return a}getStats(){return{available:this.available.length,inUse:this.inUse.size,total:this.available.length+this.inUse.size,maxSize:this.maxSize}}clear(){this.available.length=0,this.inUse.clear()}}var P=new Set,F={},v={};function D(a){if(!P.has(a.key))return;a.preventDefault(),F[a.key]=!0}function U(a){if(!P.has(a.key))return;a.preventDefault(),F[a.key]=!1}function _(a){if(!(a.key in v))return;a.preventDefault();let c=v[a.key];for(let i of c.values())i(a)}var u=new class a{get state(){return F}trackKeys(...c){for(let i of c)P.add(i)}untrackKeys(...c){for(let i of c)P.delete(i)}subscribe(c,i){if(!v[c])v[c]=new Set;v[c].add(i)}unsubscribe(c,i){if(!v[c])v[c]=new Set;return v[c].delete(i)}};document.addEventListener("keyup",U);document.addEventListener("keydown",D);document.addEventListener("keypress",_);class W{elements;isInitialized=!1;constructor(){this.elements={}}initialize(){try{return this.elements.canvas=this.getElement("gl-canvas"),this.elements.score=this.getElement("score"),this.elements.time=this.getElement("time"),this.elements.status=this.getElement("status"),this.elements.play=this.getElement("play"),this.elements.playParent=this.elements.play.parentElement,this.elements.audioToggle=this.getElement("audio-toggle"),this.isInitialized=!0,!0}catch{return!1}}getElement(a){let c=document.getElementById(a);if(!c)throw new Error(`Element with id '${a}' not found`);return c}isReady(){return this.isInitialized}getCanvas(){return this.ensureInitialized(),this.elements.canvas}updateUI(a){this.ensureInitialized(),this.updateScore(a.score),this.updateTime(a.timeMinutes,a.timeSeconds),this.updateGameStatus(a.gameStatus,a.message)}updateScore(a){this.ensureInitialized(),this.elements.score.textContent=a.toString(),this.elements.score.setAttribute("aria-label",`Current score: ${a} points`),this.elements.score.classList.add("score-update"),this.elements.score.style.animation="none",this.elements.score.offsetHeight,this.elements.score.style.animation="scoreUpdate 0.3s ease-out",setTimeout(()=>{this.elements.score.classList.remove("score-update")},300)}updateTime(a,c){this.ensureInitialized();let i,p;if(c===void 0){let y=a;i=Math.floor(Math.ceil(y)/60),p=Math.ceil(Math.ceil(y)%60)}else i=a,p=c;let s=i<10?"0"+i:i.toString(),t=p<10?"0"+p:p.toString();this.elements.time.textContent=`${s}:${t}`;let h=i*60+p;if(h<=10&&h>0)this.elements.time.classList.add("time-warning");else this.elements.time.classList.remove("time-warning");if(h<=10||h%15===0)this.elements.time.setAttribute("aria-label",`Time remaining: ${i} minutes and ${p} seconds`)}updateGameStatus(a,c){switch(this.ensureInitialized(),this.elements.status.classList.remove("win","loss"),a){case"playing":this.elements.status.textContent="",this.elements.status.setAttribute("aria-label","Game in progress"),this.hidePlayButton();break;case"paused":this.elements.status.textContent="Game Paused",this.elements.status.setAttribute("aria-label","Game is paused. Press space bar to resume."),this.showPlayButton("Press SPACE to resume!","Game is paused. Press space bar to resume");break;case"win":this.elements.status.textContent="YOU WIN!",this.elements.status.classList.add("win"),this.elements.status.setAttribute("aria-label","Game over: YOU WIN!"),this.showPlayButton("Press SPACE to play again!","Game ended. Press space bar to play again");break;case"lose":this.elements.status.textContent="YOU LOSE!",this.elements.status.classList.add("loss"),this.elements.status.setAttribute("aria-label","Game over: YOU LOSE!"),this.showPlayButton("Press SPACE to play again!","Game ended. Press space bar to play again");break;case"ready":this.elements.status.textContent="",this.elements.status.setAttribute("aria-label",""),this.showPlayButton("Press SPACE to play!","Press space bar to start the game");break}if(c)this.elements.status.textContent=c}showPlayButton(a,c){this.elements.playParent.classList.remove("hide"),this.elements.play.textContent=a,this.elements.play.setAttribute("aria-label",c)}hidePlayButton(){this.elements.playParent.classList.add("hide")}updateAudioButton(a){this.ensureInitialized();let c=this.elements.audioToggle;if(c.textContent=a?"\uD83D\uDD0A":"\uD83D\uDD07",c.setAttribute("aria-label",a?"Mute sound effects":"Unmute sound effects"),a)c.classList.remove("muted");else c.classList.add("muted")}addAudioToggleListener(a){this.ensureInitialized(),this.elements.audioToggle.addEventListener("click",a)}focusCanvas(){this.ensureInitialized(),this.elements.canvas.focus()}addCanvasListener(a,c,i){this.ensureInitialized(),this.elements.canvas.addEventListener(a,c,i)}removeCanvasListener(a,c,i){this.ensureInitialized(),this.elements.canvas.removeEventListener(a,c,i)}ensureInitialized(){if(!this.isInitialized)throw new Error("DOMManager not initialized. Call initialize() first.")}reset(){this.ensureInitialized(),this.updateUI({score:0,timeMinutes:1,timeSeconds:0,gameStatus:"ready",message:""})}destroy(){this.isInitialized=!1}initializeGameUI(a){this.ensureInitialized();let c=Math.floor(a/60),i=a%60;this.updateUI({score:0,timeMinutes:c,timeSeconds:i,gameStatus:"ready",message:""})}startGameUI(a){this.ensureInitialized(),this.updateGameStatus("playing",""),this.updateScore(0),this.updateTime(a)}endGameUI(a){this.ensureInitialized(),this.updateGameStatus(a?"win":"lose",""),this.focusCanvas()}togglePauseUI(a){this.ensureInitialized(),this.updateGameStatus(a?"paused":"playing",a?"Game Paused":"")}}function J(a,c,i){let p=a.currentTime,s=a.createOscillator(),t=a.createGain();s.connect(t),t.connect(c);let h=440,y=1+i/25;s.frequency.setValueAtTime(h*y,p),s.frequency.exponentialRampToValueAtTime(h*y*1.5,p+0.1),t.gain.setValueAtTime(0,p),t.gain.exponentialRampToValueAtTime(0.8,p+0.01),t.gain.exponentialRampToValueAtTime(0.01,p+0.15),s.type="square",s.start(p),s.stop(p+0.15)}function K(a,c){let i=a.currentTime,p=a.createOscillator(),s=a.createGain();p.connect(s),s.connect(c),p.frequency.setValueAtTime(440,i),p.frequency.exponentialRampToValueAtTime(220,i+0.8),s.gain.setValueAtTime(0,i),s.gain.exponentialRampToValueAtTime(0.4,i+0.1),s.gain.exponentialRampToValueAtTime(0.01,i+0.8),p.type="sawtooth",p.start(i),p.stop(i+0.8)}function Q(a,c){let i=a.currentTime;[261.63,329.63,392].forEach((s,t)=>{let h=a.createOscillator(),y=a.createGain();h.connect(y),y.connect(c),h.frequency.setValueAtTime(s,i),h.type="triangle";let b=i+t*0.1;y.gain.setValueAtTime(0,b),y.gain.exponentialRampToValueAtTime(0.3,b+0.05),y.gain.exponentialRampToValueAtTime(0.01,b+0.3),h.start(b),h.stop(b+0.3)})}function V(a,c,i){let p=a.currentTime,s=a.createOscillator(),t=a.createGain();if(s.connect(t),t.connect(c),i)s.frequency.setValueAtTime(800,p),s.frequency.exponentialRampToValueAtTime(400,p+0.1);else s.frequency.setValueAtTime(400,p),s.frequency.exponentialRampToValueAtTime(800,p+0.1);t.gain.setValueAtTime(0,p),t.gain.exponentialRampToValueAtTime(0.5,p+0.01),t.gain.exponentialRampToValueAtTime(0.01,p+0.1),s.type="square",s.start(p),s.stop(p+0.1)}function Z(a,c){let i=a.currentTime;[{freq:523.25,time:0},{freq:659.25,time:0.15},{freq:783.99,time:0.3},{freq:1046.5,time:0.45}].forEach((s)=>{let t=a.createOscillator(),h=a.createGain();t.connect(h),h.connect(c),t.frequency.setValueAtTime(s.freq,i+s.time),t.type="triangle";let y=i+s.time;h.gain.setValueAtTime(0,y),h.gain.exponentialRampToValueAtTime(0.4,y+0.05),h.gain.exponentialRampToValueAtTime(0.01,y+0.2),t.start(y),t.stop(y+0.2)})}class z{audioContext=null;masterGain=null;enabled=!0;constructor(){try{let a=window.AudioContext||window.webkitAudioContext;this.audioContext=new a,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=H}catch(a){console.warn("Web Audio API not supported:",a),this.enabled=!1}}async resumeAudio(){if(this.audioContext&&this.audioContext.state==="suspended")try{await this.audioContext.resume()}catch(a){console.warn("Failed to resume audio context:",a)}}toggleMute(a){if(this.enabled)return this.playMuteToggleSound(!0),setTimeout(()=>{if(this.enabled=!1,this.masterGain)this.masterGain.gain.value=0;a?.(!1)},120),!1;if(this.enabled=!0,this.masterGain)this.masterGain.gain.value=H;return a?.(!0),setTimeout(()=>{this.playMuteToggleSound(!1)},10),!0}isEnabled(){return this.enabled&&this.audioContext!==null}playBlockCatch(a){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;J(this.audioContext,this.masterGain,a)}playGameStart(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;Q(this.audioContext,this.masterGain)}playGameOver(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;K(this.audioContext,this.masterGain)}playVictory(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;Z(this.audioContext,this.masterGain)}playMuteToggleSound(a){if(!this.audioContext||!this.masterGain)return;if(!this.enabled)return;V(this.audioContext,this.masterGain,a)}}var Ja=new class a{domManager;audioManager;renderer;player;blocks;blockPool;state;constructor(){this.tick=this.tick.bind(this),this.startGame=this.startGame.bind(this),this.initialize=this.initialize.bind(this),this.togglePause=this.togglePause.bind(this),this.state={score:0,started:!1,timeLeft:f,lastFrame:performance.now(),blockSpawn:g,paused:!1},document.addEventListener("DOMContentLoaded",this.initialize),u.subscribe(" ",this.startGame),u.trackKeys("ArrowLeft","ArrowRight")}initialize(){if(this.domManager=new W,!this.domManager.initialize())throw new Error("Failed to initialize DOM elements");this.audioManager=new z,this.domManager.updateAudioButton(this.audioManager.isEnabled()),this.domManager.addAudioToggleListener(()=>{this.audioManager.toggleMute((c)=>{this.domManager.updateAudioButton(c)})}),this.domManager.initializeGameUI(f),this.renderer=new o(this.domManager.getCanvas()),this.player=new e(this.renderer),this.blocks=[],this.blockPool=new B(()=>new G(this.renderer),20,50),this.tick(performance.now()),this.renderer.drawWithStroke(this.player),this.domManager.focusCanvas()}tick(c){if(this.state.paused||!this.state.started){this.state.lastFrame=c,window.requestAnimationFrame(this.tick);return}let i=c-this.state.lastFrame;if(this.state.lastFrame=c,this.state.timeLeft=Math.max(0,this.state.timeLeft-i/1000),this.domManager.updateTime(this.state.timeLeft),this.state.timeLeft<=0){this.endGame(),window.requestAnimationFrame(this.tick);return}if(this.state.blockSpawn=Math.max(0,this.state.blockSpawn-i),this.state.blockSpawn<=0){let s=this.blockPool.acquire();if(s)this.blocks.push(s);this.state.blockSpawn=g}let p=u.state.ArrowLeft?-1:u.state.ArrowRight?1:0;this.player.step(i,!this.state.started?0:p);for(let s=0;s<this.blocks.length;s++)if(this.blocks[s].step(i),this.player.collides(this.blocks[s]))this.addScore(this.blocks[s].blockData.points),this.blockPool.release(this.blocks[s]),this.blocks.splice(s,1),s--;else if(this.blocks[s].y<=-1)this.blockPool.release(this.blocks[s]),this.blocks.splice(s,1),s--;this.renderer.clearColorBuffer(),this.renderer.drawWithStroke(this.player);for(let s=0;s<this.blocks.length;s++)this.renderer.drawWithStroke(this.blocks[s]);window.requestAnimationFrame(this.tick)}startGame(){if(this.state.started)return this.togglePause();this.audioManager.resumeAudio(),this.state.timeLeft=f,this.state.blockSpawn=g,this.state.paused=!1,this.state.started=!0,this.state.score=0,this.domManager.startGameUI(f),this.audioManager.playGameStart()}addScore(c){this.state.score=this.state.score+c,this.domManager.updateScore(this.state.score),this.audioManager.playBlockCatch(c)}endGame(){if(!this.state.started)return;this.state.started=!1;let c=this.state.score>=T;if(this.domManager.endGameUI(c),c)this.audioManager.playVictory();else this.audioManager.playGameOver();for(let i of this.blocks)this.blockPool.release(i);this.blocks.splice(0,this.blocks.length)}togglePause(){if(!this.state.started)return;this.state.paused=!this.state.paused,this.domManager.togglePauseUI(this.state.paused)}};
