var A=`attribute vec4 myPosition;

uniform float xshift;
uniform float yshift;

void main() {
    // Direct position calculation - more efficient than matrix multiplication
    gl_Position = vec4(myPosition.x + xshift, myPosition.y + yshift, 0.0, 1.0);
    gl_PointSize = 1.0;
}`;var C=`precision mediump float;

uniform vec4 u_color;

void main() {
    gl_FragColor = u_color;
}`;var E="hot"in import.meta?25:500,u="hot"in import.meta?30:60,g="hot"in import.meta?100:1000,K=0.6,Q=[1,1,1],G=[0,0,0],f=[{color:[1,0,0.5],speed:1,size:2.5,points:1},{color:[0.6,0.2,0.8],speed:2,size:1.5,points:5},{color:[0,1,1],speed:3,size:1,points:25}];function m(a,p=0.7){return[Math.max(0,a[0]*p),Math.max(0,a[1]*p),Math.max(0,a[2]*p)]}class d{webgl;vertexShader;fragShader;shaderProgram;positionLocation;xshiftLocation;yshiftLocation;colorLocation;programBound=!1;vertexArrayEnabled=!1;constructor(a){this.webgl=a.getContext("webgl"),this.webgl.viewport(0,0,512,512),this.webgl.clearColor(G[0],G[1],G[2],1),this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.vertexShader=this.webgl.createShader(this.webgl.VERTEX_SHADER),this.webgl.shaderSource(this.vertexShader,A),this.webgl.compileShader(this.vertexShader),this.fragShader=this.webgl.createShader(this.webgl.FRAGMENT_SHADER),this.webgl.shaderSource(this.fragShader,C),this.webgl.compileShader(this.fragShader),this.shaderProgram=this.webgl.createProgram(),this.webgl.attachShader(this.shaderProgram,this.vertexShader),this.webgl.attachShader(this.shaderProgram,this.fragShader),this.webgl.linkProgram(this.shaderProgram),this.webgl.useProgram(this.shaderProgram),this.programBound=!0,this.positionLocation=this.webgl.getAttribLocation(this.shaderProgram,"myPosition"),this.xshiftLocation=this.webgl.getUniformLocation(this.shaderProgram,"xshift"),this.yshiftLocation=this.webgl.getUniformLocation(this.shaderProgram,"yshift"),this.colorLocation=this.webgl.getUniformLocation(this.shaderProgram,"u_color")}createBuffer(a){let p=this.webgl.createBuffer();return this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,p),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,Float32Array.from(a.flat()),this.webgl.STATIC_DRAW),p}clearColorBuffer(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}invalidateProgramState(){this.programBound=!1}draw(a){this.ensureProgramBound(),this.setupVertexAttributes(a.buffer),this.setUniforms(a.uniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length)}drawWithStroke(a){this.ensureProgramBound(),this.setupVertexAttributes(a.buffer),this.setUniforms(a.strokeUniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length),this.setupVertexAttributes(a.mainBuffer),this.setUniforms(a.uniforms),this.webgl.drawArrays(this.webgl.TRIANGLE_FAN,0,a.points.length)}setupVertexAttributes(a){this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,a),this.ensureVertexArrayEnabled(),this.webgl.vertexAttribPointer(this.positionLocation,2,this.webgl.FLOAT,!1,0,0)}setUniforms(a){this.webgl.uniform1f(this.xshiftLocation,a.xshift),this.webgl.uniform1f(this.yshiftLocation,a.yshift),this.webgl.uniform4f(this.colorLocation,a.color[0],a.color[1],a.color[2],1)}ensureProgramBound(){if(!this.programBound)this.webgl.useProgram(this.shaderProgram),this.programBound=!0}ensureVertexArrayEnabled(){if(!this.vertexArrayEnabled)this.webgl.enableVertexAttribArray(this.positionLocation),this.vertexArrayEnabled=!0}}function T(a,p=0){return a.concat(Array(p).fill(0)).slice(0,p)}function l(...a){return T([...a],2)}class r{points;constructor(a){if(a.length!==4)throw new Error("Wrong number of vertices for a rectangle. Expected 4, but got "+a.length);this.points=a}get topLeft(){return this.points[0]}get topRight(){return this.points[1]}get bottomRight(){return this.points[2]}get bottomLeft(){return this.points[3]}get x(){return this.topLeft[0]}get y(){return this.topLeft[1]}get width(){return this.topRight[0]-this.topLeft[0]}get height(){return this.topLeft[1]-this.bottomLeft[1]}collides(a){let p=this.x<a.x+a.width,s=this.x+this.width>a.x,i=this.y>a.y-a.height,c=this.y-this.height<a.y;return p&&s&&i&&c}}class B extends r{velocity=0;shiftX=0;deltaTrans=0.03;buffer;mainBuffer;constructor(a){super([l(-0.15,-0.925),l(0.15,-0.925),l(0.15,-0.975),l(-0.15,-0.975)]);this.buffer=a.createBuffer(this.points);let p=0.01,s=[l(-0.15+p,-0.925-p),l(0.15-p,-0.925-p),l(0.15-p,-0.975+p),l(-0.15+p,-0.975+p)];this.mainBuffer=a.createBuffer(s)}get uniforms(){return{xshift:this.shiftX,yshift:0,color:Q}}get strokeUniforms(){return{xshift:this.shiftX,yshift:0,color:m(Q)}}step(a,p){let s=p*this.deltaTrans;if(s*=a/25,this.topLeft[0]+s>=-1.01&&this.bottomRight[0]+s<1.01){this.shiftX+=s;for(let i=0;i<this.points.length;i++)this.points[i][0]=this.points[i][0]+s}}}var y=0.1;class P extends r{blockData;shiftY;deltaTrans;buffer;mainBuffer;active=!1;renderer;constructor(a){super([l(0,0),l(0,0),l(0,0),l(0,0)]);this.renderer=a,this.blockData=f[0],this.shiftY=0,this.deltaTrans=0,this.buffer=a.createBuffer(this.points),this.mainBuffer=a.createBuffer(this.points),this.active=!1,this.reset()}get uniforms(){return{xshift:0,yshift:this.shiftY,color:this.blockData.color}}get strokeUniforms(){return{xshift:0,yshift:this.shiftY,color:m(this.blockData.color,0.6)}}step(a,p=!1){let s=p?this.deltaTrans:-this.deltaTrans;s*=a/25,this.shiftY+=s;for(let i=0;i<this.points.length;i++)this.points[i][1]=this.points[i][1]+s}reset(){let a=Math.floor(Math.random()*f.length);this.blockData=f[a];let p=Math.random()*(1-y*this.blockData.size+1)-1;this.points=[l(p,1.01+y*this.blockData.size),l(p+y*this.blockData.size,1.01+y*this.blockData.size),l(p+y*this.blockData.size,1.01),l(p,1.01)],this.shiftY=0,this.deltaTrans=0.01*this.blockData.speed,this.active=!0,this.renderer.webgl.bindBuffer(this.renderer.webgl.ARRAY_BUFFER,this.buffer),this.renderer.webgl.bufferData(this.renderer.webgl.ARRAY_BUFFER,Float32Array.from(this.points.flat()),this.renderer.webgl.STATIC_DRAW);let s=0.01,i=[l(p+s,1.01+y*this.blockData.size-s),l(p+y*this.blockData.size-s,1.01+y*this.blockData.size-s),l(p+y*this.blockData.size-s,1.01+s),l(p+s,1.01+s)];this.renderer.webgl.bindBuffer(this.renderer.webgl.ARRAY_BUFFER,this.mainBuffer),this.renderer.webgl.bufferData(this.renderer.webgl.ARRAY_BUFFER,Float32Array.from(i.flat()),this.renderer.webgl.STATIC_DRAW)}isActive(){return this.active}prepareForPool(){this.active=!1}}class W{available=[];inUse=new Set;createFn;maxSize;constructor(a,p,s){this.createFn=a,this.maxSize=s??p*2;for(let i=0;i<p;i++){let c=this.createFn();c.reset(),this.available.push(c)}}acquire(){let a;if(this.available.length>0)a=this.available.pop();else if(this.inUse.size<this.maxSize)a=this.createFn();else return null;return this.inUse.add(a),a.reset(),a}release(a){if(this.inUse.has(a))this.inUse.delete(a),a.prepareForPool?.(),this.available.push(a)}releaseInactive(){let a=0;for(let p of this.inUse)if(!p.isActive())this.release(p),a++;return a}getStats(){return{available:this.available.length,inUse:this.inUse.size,total:this.available.length+this.inUse.size,maxSize:this.maxSize}}clear(){this.available.length=0,this.inUse.clear()}}var F=new Set,V={},b={};function _(a){if(!F.has(a.key))return;a.preventDefault(),V[a.key]=!0}function L(a){if(!F.has(a.key))return;a.preventDefault(),V[a.key]=!1}function w(a){if(!(a.key in b))return;a.preventDefault();let p=b[a.key];for(let s of p.values())s(a)}var k=new class a{get state(){return V}trackKeys(...p){for(let s of p)F.add(s)}untrackKeys(...p){for(let s of p)F.delete(s)}subscribe(p,s){if(!b[p])b[p]=new Set;b[p].add(s)}unsubscribe(p,s){if(!b[p])b[p]=new Set;return b[p].delete(s)}};document.addEventListener("keyup",L);document.addEventListener("keydown",_);document.addEventListener("keypress",w);class H{elements;isInitialized=!1;constructor(){this.elements={}}initialize(){try{return this.elements.canvas=this.getElement("gl-canvas"),this.elements.score=this.getElement("score"),this.elements.time=this.getElement("time"),this.elements.status=this.getElement("status"),this.elements.play=this.getElement("play"),this.elements.playParent=this.elements.play.parentElement,this.elements.audioToggle=this.getElement("audio-toggle"),this.isInitialized=!0,!0}catch{return!1}}getElement(a){let p=document.getElementById(a);if(!p)throw new Error(`Element with id '${a}' not found`);return p}isReady(){return this.isInitialized}getCanvas(){return this.ensureInitialized(),this.elements.canvas}updateUI(a){this.ensureInitialized(),this.updateScore(a.score),this.updateTime(a.timeMinutes,a.timeSeconds),this.updateGameStatus(a.gameStatus,a.message)}updateScore(a){this.ensureInitialized(),this.elements.score.textContent=a.toString(),this.elements.score.setAttribute("aria-label",`Current score: ${a} points`),this.elements.score.classList.add("score-update"),this.elements.score.style.animation="none",this.elements.score.offsetHeight,this.elements.score.style.animation="scoreUpdate 0.3s ease-out",setTimeout(()=>{this.elements.score.classList.remove("score-update")},300)}updateTime(a,p){this.ensureInitialized();let s,i;if(p===void 0){let h=a;s=Math.floor(Math.ceil(h)/60),i=Math.ceil(Math.ceil(h)%60)}else s=a,i=p;let c=s<10?"0"+s:s.toString(),t=i<10?"0"+i:i.toString();this.elements.time.textContent=`${c}:${t}`;let v=s*60+i;if(v<=10&&v>0)this.elements.time.classList.add("time-warning");else this.elements.time.classList.remove("time-warning");if(v<=10||v%15===0)this.elements.time.setAttribute("aria-label",`Time remaining: ${s} minutes and ${i} seconds`)}updateGameStatus(a,p){switch(this.ensureInitialized(),this.elements.status.classList.remove("win","loss"),a){case"playing":this.elements.status.textContent="",this.elements.status.setAttribute("aria-label","Game in progress"),this.hidePlayButton();break;case"paused":this.elements.status.textContent="Game Paused",this.elements.status.setAttribute("aria-label","Game is paused. Press space bar to resume."),this.showPlayButton("Press SPACE to resume!","Game is paused. Press space bar to resume");break;case"win":this.elements.status.textContent="YOU WIN!",this.elements.status.classList.add("win"),this.elements.status.setAttribute("aria-label","Game over: YOU WIN!"),this.showPlayButton("Press SPACE to play again!","Game ended. Press space bar to play again");break;case"lose":this.elements.status.textContent="YOU LOSE!",this.elements.status.classList.add("loss"),this.elements.status.setAttribute("aria-label","Game over: YOU LOSE!"),this.showPlayButton("Press SPACE to play again!","Game ended. Press space bar to play again");break;case"ready":this.elements.status.textContent="",this.elements.status.setAttribute("aria-label",""),this.showPlayButton("Press SPACE to play!","Press space bar to start the game");break}if(p)this.elements.status.textContent=p}showPlayButton(a,p){this.elements.playParent.classList.remove("hide"),this.elements.play.textContent=a,this.elements.play.setAttribute("aria-label",p)}hidePlayButton(){this.elements.playParent.classList.add("hide")}updateAudioButton(a){this.ensureInitialized();let p=this.elements.audioToggle;if(p.textContent=a?"\uD83D\uDD0A":"\uD83D\uDD07",p.setAttribute("aria-label",a?"Mute sound effects":"Unmute sound effects"),a)p.classList.remove("muted");else p.classList.add("muted")}addAudioToggleListener(a){this.ensureInitialized(),this.elements.audioToggle.addEventListener("click",a)}focusCanvas(){this.ensureInitialized(),this.elements.canvas.focus()}addCanvasListener(a,p,s){this.ensureInitialized(),this.elements.canvas.addEventListener(a,p,s)}removeCanvasListener(a,p,s){this.ensureInitialized(),this.elements.canvas.removeEventListener(a,p,s)}ensureInitialized(){if(!this.isInitialized)throw new Error("DOMManager not initialized. Call initialize() first.")}reset(){this.ensureInitialized(),this.updateUI({score:0,timeMinutes:1,timeSeconds:0,gameStatus:"ready",message:""})}destroy(){this.isInitialized=!1}initializeGameUI(a){this.ensureInitialized();let p=Math.floor(a/60),s=a%60;this.updateUI({score:0,timeMinutes:p,timeSeconds:s,gameStatus:"ready",message:""})}startGameUI(a){this.ensureInitialized(),this.updateGameStatus("playing",""),this.updateScore(0),this.updateTime(a)}endGameUI(a){this.ensureInitialized(),this.updateGameStatus(a?"win":"lose",""),this.focusCanvas()}togglePauseUI(a){this.ensureInitialized(),this.updateGameStatus(a?"paused":"playing",a?"Game Paused":"")}}function Z(a,p,s){let i=a.currentTime,c=a.createOscillator(),t=a.createGain();c.connect(t),t.connect(p);let v=440,h=1+s/25;c.frequency.setValueAtTime(v*h,i),c.frequency.exponentialRampToValueAtTime(v*h*1.5,i+0.1),t.gain.setValueAtTime(0,i),t.gain.exponentialRampToValueAtTime(0.8,i+0.01),t.gain.exponentialRampToValueAtTime(0.01,i+0.15),c.type="square",c.start(i),c.stop(i+0.15)}function $(a,p){let s=a.currentTime,i=a.createOscillator(),c=a.createGain();i.connect(c),c.connect(p),i.frequency.setValueAtTime(440,s),i.frequency.exponentialRampToValueAtTime(220,s+0.8),c.gain.setValueAtTime(0,s),c.gain.exponentialRampToValueAtTime(0.4,s+0.1),c.gain.exponentialRampToValueAtTime(0.01,s+0.8),i.type="sawtooth",i.start(s),i.stop(s+0.8)}function z(a,p){let s=a.currentTime;[261.63,329.63,392].forEach((c,t)=>{let v=a.createOscillator(),h=a.createGain();v.connect(h),h.connect(p),v.frequency.setValueAtTime(c,s),v.type="triangle";let n=s+t*0.1;h.gain.setValueAtTime(0,n),h.gain.exponentialRampToValueAtTime(0.3,n+0.05),h.gain.exponentialRampToValueAtTime(0.01,n+0.3),v.start(n),v.stop(n+0.3)})}function Y(a,p,s){let i=a.currentTime,c=a.createOscillator(),t=a.createGain();if(c.connect(t),t.connect(p),s)c.frequency.setValueAtTime(800,i),c.frequency.exponentialRampToValueAtTime(400,i+0.1);else c.frequency.setValueAtTime(400,i),c.frequency.exponentialRampToValueAtTime(800,i+0.1);t.gain.setValueAtTime(0,i),t.gain.exponentialRampToValueAtTime(0.5,i+0.01),t.gain.exponentialRampToValueAtTime(0.01,i+0.1),c.type="square",c.start(i),c.stop(i+0.1)}function q(a,p){let s=a.currentTime;[{freq:523.25,time:0},{freq:659.25,time:0.15},{freq:783.99,time:0.3},{freq:1046.5,time:0.45}].forEach((c)=>{let t=a.createOscillator(),v=a.createGain();t.connect(v),v.connect(p),t.frequency.setValueAtTime(c.freq,s+c.time),t.type="triangle";let h=s+c.time;v.gain.setValueAtTime(0,h),v.gain.exponentialRampToValueAtTime(0.4,h+0.05),v.gain.exponentialRampToValueAtTime(0.01,h+0.2),t.start(h),t.stop(h+0.2)})}class J{audioContext=null;masterGain=null;enabled=!0;constructor(){try{let a=window.AudioContext||window.webkitAudioContext;this.audioContext=new a,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=K}catch(a){console.warn("Web Audio API not supported:",a),this.enabled=!1}}async resumeAudio(){if(this.audioContext&&this.audioContext.state==="suspended")try{await this.audioContext.resume()}catch(a){console.warn("Failed to resume audio context:",a)}}toggleMute(a){if(this.enabled)return this.playMuteToggleSound(!0),setTimeout(()=>{if(this.enabled=!1,this.masterGain)this.masterGain.gain.value=0;a?.(!1)},120),!1;if(this.enabled=!0,this.masterGain)this.masterGain.gain.value=K;return a?.(!0),setTimeout(()=>{this.playMuteToggleSound(!1)},10),!0}isEnabled(){return this.enabled&&this.audioContext!==null}playBlockCatch(a){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;Z(this.audioContext,this.masterGain,a)}playGameStart(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;z(this.audioContext,this.masterGain)}playGameOver(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;$(this.audioContext,this.masterGain)}playVictory(){if(!this.isEnabled()||!this.audioContext||!this.masterGain)return;q(this.audioContext,this.masterGain)}playMuteToggleSound(a){if(!this.audioContext||!this.masterGain)return;if(!this.enabled)return;Y(this.audioContext,this.masterGain,a)}}var Za=new class a{domManager;audioManager;renderer;player;blocks;blockPool;state;constructor(){this.tick=this.tick.bind(this),this.startGame=this.startGame.bind(this),this.initialize=this.initialize.bind(this),this.togglePause=this.togglePause.bind(this),this.state={score:0,started:!1,timeLeft:u,lastFrame:performance.now(),blockSpawn:g,paused:!1},document.addEventListener("DOMContentLoaded",this.initialize),k.subscribe(" ",this.startGame),k.trackKeys("ArrowLeft","ArrowRight")}initialize(){if(this.domManager=new H,!this.domManager.initialize())throw new Error("Failed to initialize DOM elements");this.audioManager=new J,this.domManager.updateAudioButton(this.audioManager.isEnabled()),this.domManager.addAudioToggleListener(()=>{this.audioManager.toggleMute((p)=>{this.domManager.updateAudioButton(p)})}),this.domManager.initializeGameUI(u),this.renderer=new d(this.domManager.getCanvas()),this.player=new B(this.renderer),this.blocks=[],this.blockPool=new W(()=>new P(this.renderer),20,50),this.tick(performance.now()),this.renderer.drawWithStroke(this.player),this.domManager.focusCanvas()}tick(p){if(this.state.paused||!this.state.started){this.state.lastFrame=p,window.requestAnimationFrame(this.tick);return}let s=p-this.state.lastFrame;if(this.state.lastFrame=p,this.state.timeLeft=Math.max(0,this.state.timeLeft-s/1000),this.domManager.updateTime(this.state.timeLeft),this.state.timeLeft<=0){this.endGame(),window.requestAnimationFrame(this.tick);return}if(this.state.blockSpawn=Math.max(0,this.state.blockSpawn-s),this.state.blockSpawn<=0){let c=this.blockPool.acquire();if(c)this.blocks.push(c);this.state.blockSpawn=g}let i=k.state.ArrowLeft?-1:k.state.ArrowRight?1:0;this.player.step(s,!this.state.started?0:i);for(let c=0;c<this.blocks.length;c++)if(this.blocks[c].step(s),this.player.collides(this.blocks[c]))this.addScore(this.blocks[c].blockData.points),this.blockPool.release(this.blocks[c]),this.blocks.splice(c,1),c--;else if(this.blocks[c].y<=-1)this.blockPool.release(this.blocks[c]),this.blocks.splice(c,1),c--;this.renderer.clearColorBuffer(),this.renderer.drawWithStroke(this.player);for(let c=0;c<this.blocks.length;c++)this.renderer.drawWithStroke(this.blocks[c]);window.requestAnimationFrame(this.tick)}startGame(){if(this.state.started)return this.togglePause();this.audioManager.resumeAudio(),this.state.timeLeft=u,this.state.blockSpawn=g,this.state.paused=!1,this.state.started=!0,this.state.score=0,this.domManager.startGameUI(u),this.audioManager.playGameStart()}addScore(p){this.state.score=this.state.score+p,this.domManager.updateScore(this.state.score),this.audioManager.playBlockCatch(p)}endGame(){if(!this.state.started)return;this.state.started=!1;let p=this.state.score>=E;if(this.domManager.endGameUI(p),p)this.audioManager.playVictory();else this.audioManager.playGameOver();for(let s of this.blocks)this.blockPool.release(s);this.blocks.splice(0,this.blocks.length)}togglePause(){if(!this.state.started)return;this.state.paused=!this.state.paused,this.domManager.togglePauseUI(this.state.paused)}};
